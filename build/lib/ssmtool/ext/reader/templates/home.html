<html>
    <head>
        <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='bulma.min.css') }}"/>
        <script src="{{ url_for('static', filename='jquery-3.6.0.min.js') }}"></script>
        <style>
            html {
                background-color: #add;
            }
            .navbar {
                margin-bottom: 1.5rem;
            }
            .boxlink {
                display: block;
            }
            #master {
              padding-left: 5%;
              padding-right: 5%;
            }
            .button-box {
              display: None;
            }
        </style>
    </head>
  <body>
    <nav class="navbar" role="navigation" aria-label="main navigation">
      <div class="navbar-brand">
        <a class="navbar-item" href="/">
          <h5 class="title is-5">FLT Web Reader</h5>
        </a>
        <a class="navbar-item" href="/upload">Upload text</a>
      </div>
      <div class="navbar-menu">
      </div>
    </nav>
    <div id="master" class="container">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
              <div class="notification is-primary">{{message}}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}
      <div class="block level is-mobile">
        <div class="level-left">
          <h1 class="title is-1">Texts</h1>
        </div>
        <div class="level-right">
          <button id="edit" class="button is-primary is-medium is-rounded">Edit</button>
        </div>
      </div>
    {% for text in texts %}
          <div class="box">
              <a class="boxlink" href="/read/{{text.id}}">
                  <div class="title is-3 bookname"><i class="fas fa-book"></i>{{text.title}}</div>
              </a>
              <h6 class="subtitle is-6 mb-2">{{"%.2f"|format(text.progress/10000)}}% - {{(text.progress/1000000*text.length)|round|int}}/{{text.length}} words</h6>
              <progress class="progress is-small mb-0" value="{{text.progress/1000000}}">{{text.progress/10000}}%</progress>
              <div class="button-box buttons mb-0">
                <button id="stats-{{text.id}}" class="button is-info">Stats</button>
                <button id="archive-{{text.id}}" class="button is-warning">Archive</button>
                <button id="delete-{{text.id}}" class="button is-danger">Delete</button>
              </div>
              <script>
                $("button#delete-{{text.id}}").click(() => {
                  console.log("deleting item with ID " + {{text.id}})
                  if(confirm("Are you sure you want to delete {{text.title}}?")){
                    console.log("deleteing")
                    $.ajax({
                      url: "{{ url_for('delete', id=text.id) }}",
                      type: 'DELETE',
                      success: ()=>{
                        window.location.reload();
                      }
                    })
                  }
                })
              </script>
            </div>
    {% endfor %}
    </div>
    <script>
      $("button#edit").click(() => {
        $(".button-box").toggle();
        $(".box progress.progress").toggleClass("mb-0")
        $(".box progress.progress").toggleClass("mb-2")
        console.log("helo")
      })
    </script>
  </body>
</html>